{
  "hash": "3f5819e3102bb391d01b0b2d03cfd9a2",
  "result": {
    "markdown": "---\ntitle: \"Homework 3\"\nauthor: \"Tanmay Agrawal\"\ndesription: \"Exploratory Data Analysis\"\ndate: \"01/24/2023\"\nformat:\n  html:\n    toc: true\n    code-fold: true\n    code-copy: true\n    code-tools: true\n    df-print: paged\ncategories:\n  - hw3\n  - hotel_bookings.csv\n---\n\n\nWe first load the necessary libraries\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n✔ ggplot2 3.4.0      ✔ purrr   1.0.0 \n✔ tibble  3.1.8      ✔ dplyr   1.0.10\n✔ tidyr   1.2.1      ✔ stringr 1.5.0 \n✔ readr   2.1.3      ✔ forcats 0.5.2 \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n```\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(dplyr)\nknitr::opts_chunk$set(echo = TRUE)\n```\n:::\n\n\nNow we load the data. I sorted the datasets by size and picked the largest one which is \"hotel_bookings.csv\". I will use the `read_csv()` function as it's the recommend way to load files.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata = read_csv(\"_data/hotel_bookings.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 119390 Columns: 32\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (13): hotel, arrival_date_month, meal, country, market_segment, distrib...\ndbl  (18): is_canceled, lead_time, arrival_date_year, arrival_date_week_numb...\ndate  (1): reservation_status_date\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n```{.r .cell-code}\n# We inspect the columns in this dataset using the head command\nhead(data)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"hotel\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"is_canceled\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"lead_time\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"arrival_date_year\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"arrival_date_month\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"arrival_date_week_number\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"arrival_date_day_of_month\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"stays_in_weekend_nights\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"stays_in_week_nights\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"adults\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"children\"],\"name\":[11],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"babies\"],\"name\":[12],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"meal\"],\"name\":[13],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"country\"],\"name\":[14],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"market_segment\"],\"name\":[15],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"distribution_channel\"],\"name\":[16],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"is_repeated_guest\"],\"name\":[17],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"previous_cancellations\"],\"name\":[18],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"previous_bookings_not_canceled\"],\"name\":[19],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"reserved_room_type\"],\"name\":[20],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"assigned_room_type\"],\"name\":[21],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"booking_changes\"],\"name\":[22],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"deposit_type\"],\"name\":[23],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"agent\"],\"name\":[24],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"company\"],\"name\":[25],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"days_in_waiting_list\"],\"name\":[26],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"customer_type\"],\"name\":[27],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"adr\"],\"name\":[28],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"required_car_parking_spaces\"],\"name\":[29],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"total_of_special_requests\"],\"name\":[30],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"reservation_status\"],\"name\":[31],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"reservation_status_date\"],\"name\":[32],\"type\":[\"date\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Resort Hotel\",\"2\":\"0\",\"3\":\"342\",\"4\":\"2015\",\"5\":\"July\",\"6\":\"27\",\"7\":\"1\",\"8\":\"0\",\"9\":\"0\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"BB\",\"14\":\"PRT\",\"15\":\"Direct\",\"16\":\"Direct\",\"17\":\"0\",\"18\":\"0\",\"19\":\"0\",\"20\":\"C\",\"21\":\"C\",\"22\":\"3\",\"23\":\"No Deposit\",\"24\":\"NULL\",\"25\":\"NULL\",\"26\":\"0\",\"27\":\"Transient\",\"28\":\"0\",\"29\":\"0\",\"30\":\"0\",\"31\":\"Check-Out\",\"32\":\"2015-07-01\"},{\"1\":\"Resort Hotel\",\"2\":\"0\",\"3\":\"737\",\"4\":\"2015\",\"5\":\"July\",\"6\":\"27\",\"7\":\"1\",\"8\":\"0\",\"9\":\"0\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"BB\",\"14\":\"PRT\",\"15\":\"Direct\",\"16\":\"Direct\",\"17\":\"0\",\"18\":\"0\",\"19\":\"0\",\"20\":\"C\",\"21\":\"C\",\"22\":\"4\",\"23\":\"No Deposit\",\"24\":\"NULL\",\"25\":\"NULL\",\"26\":\"0\",\"27\":\"Transient\",\"28\":\"0\",\"29\":\"0\",\"30\":\"0\",\"31\":\"Check-Out\",\"32\":\"2015-07-01\"},{\"1\":\"Resort Hotel\",\"2\":\"0\",\"3\":\"7\",\"4\":\"2015\",\"5\":\"July\",\"6\":\"27\",\"7\":\"1\",\"8\":\"0\",\"9\":\"1\",\"10\":\"1\",\"11\":\"0\",\"12\":\"0\",\"13\":\"BB\",\"14\":\"GBR\",\"15\":\"Direct\",\"16\":\"Direct\",\"17\":\"0\",\"18\":\"0\",\"19\":\"0\",\"20\":\"A\",\"21\":\"C\",\"22\":\"0\",\"23\":\"No Deposit\",\"24\":\"NULL\",\"25\":\"NULL\",\"26\":\"0\",\"27\":\"Transient\",\"28\":\"75\",\"29\":\"0\",\"30\":\"0\",\"31\":\"Check-Out\",\"32\":\"2015-07-02\"},{\"1\":\"Resort Hotel\",\"2\":\"0\",\"3\":\"13\",\"4\":\"2015\",\"5\":\"July\",\"6\":\"27\",\"7\":\"1\",\"8\":\"0\",\"9\":\"1\",\"10\":\"1\",\"11\":\"0\",\"12\":\"0\",\"13\":\"BB\",\"14\":\"GBR\",\"15\":\"Corporate\",\"16\":\"Corporate\",\"17\":\"0\",\"18\":\"0\",\"19\":\"0\",\"20\":\"A\",\"21\":\"A\",\"22\":\"0\",\"23\":\"No Deposit\",\"24\":\"304\",\"25\":\"NULL\",\"26\":\"0\",\"27\":\"Transient\",\"28\":\"75\",\"29\":\"0\",\"30\":\"0\",\"31\":\"Check-Out\",\"32\":\"2015-07-02\"},{\"1\":\"Resort Hotel\",\"2\":\"0\",\"3\":\"14\",\"4\":\"2015\",\"5\":\"July\",\"6\":\"27\",\"7\":\"1\",\"8\":\"0\",\"9\":\"2\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"BB\",\"14\":\"GBR\",\"15\":\"Online TA\",\"16\":\"TA/TO\",\"17\":\"0\",\"18\":\"0\",\"19\":\"0\",\"20\":\"A\",\"21\":\"A\",\"22\":\"0\",\"23\":\"No Deposit\",\"24\":\"240\",\"25\":\"NULL\",\"26\":\"0\",\"27\":\"Transient\",\"28\":\"98\",\"29\":\"0\",\"30\":\"1\",\"31\":\"Check-Out\",\"32\":\"2015-07-03\"},{\"1\":\"Resort Hotel\",\"2\":\"0\",\"3\":\"14\",\"4\":\"2015\",\"5\":\"July\",\"6\":\"27\",\"7\":\"1\",\"8\":\"0\",\"9\":\"2\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"BB\",\"14\":\"GBR\",\"15\":\"Online TA\",\"16\":\"TA/TO\",\"17\":\"0\",\"18\":\"0\",\"19\":\"0\",\"20\":\"A\",\"21\":\"A\",\"22\":\"0\",\"23\":\"No Deposit\",\"24\":\"240\",\"25\":\"NULL\",\"26\":\"0\",\"27\":\"Transient\",\"28\":\"98\",\"29\":\"0\",\"30\":\"1\",\"31\":\"Check-Out\",\"32\":\"2015-07-03\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\nThe dataset contains booking information for hotels, and includes information such as the time of booking, length of stay, the number of guests, cancellations, etc. We look at the first few rows of the data to get a visual outline of the dataset and we observe that columns `agent`, `company` and `country` have a lot of `NULL` values. We can use the following to get a column-wise representation of all the garbage values.\n\n## Cleaning the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata %>%\n  summarize_all(list(~ sum(is.na(.))))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"hotel\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"is_canceled\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"lead_time\"],\"name\":[3],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"arrival_date_year\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"arrival_date_month\"],\"name\":[5],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"arrival_date_week_number\"],\"name\":[6],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"arrival_date_day_of_month\"],\"name\":[7],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"stays_in_weekend_nights\"],\"name\":[8],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"stays_in_week_nights\"],\"name\":[9],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"adults\"],\"name\":[10],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"children\"],\"name\":[11],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"babies\"],\"name\":[12],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"meal\"],\"name\":[13],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"country\"],\"name\":[14],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"market_segment\"],\"name\":[15],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"distribution_channel\"],\"name\":[16],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"is_repeated_guest\"],\"name\":[17],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"previous_cancellations\"],\"name\":[18],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"previous_bookings_not_canceled\"],\"name\":[19],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"reserved_room_type\"],\"name\":[20],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"assigned_room_type\"],\"name\":[21],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"booking_changes\"],\"name\":[22],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"deposit_type\"],\"name\":[23],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"agent\"],\"name\":[24],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"company\"],\"name\":[25],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"days_in_waiting_list\"],\"name\":[26],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"customer_type\"],\"name\":[27],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"adr\"],\"name\":[28],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"required_car_parking_spaces\"],\"name\":[29],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"total_of_special_requests\"],\"name\":[30],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"reservation_status\"],\"name\":[31],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"reservation_status_date\"],\"name\":[32],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"0\",\"2\":\"0\",\"3\":\"0\",\"4\":\"0\",\"5\":\"0\",\"6\":\"0\",\"7\":\"0\",\"8\":\"0\",\"9\":\"0\",\"10\":\"0\",\"11\":\"4\",\"12\":\"0\",\"13\":\"0\",\"14\":\"0\",\"15\":\"0\",\"16\":\"0\",\"17\":\"0\",\"18\":\"0\",\"19\":\"0\",\"20\":\"0\",\"21\":\"0\",\"22\":\"0\",\"23\":\"0\",\"24\":\"0\",\"25\":\"0\",\"26\":\"0\",\"27\":\"0\",\"28\":\"0\",\"29\":\"0\",\"30\":\"0\",\"31\":\"0\",\"32\":\"0\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\nWe observe that only `children` column has `na` values even our manual inspection told us a different story. Let's dig in a bit more and identify why the code block above doesn't give us the expected results. \n\nWe observe that the columns like `agent` and `company` have \"NULL\" values, but they don't show up with the method above. The challenge here is that these values are still character data types and can't be detected if we're looking for `na` or `nan` values. We can simply use the `stringr` package and calculate the percentage of \"NULL\" strings each column has.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# we use the stringr package for this\nlibrary(stringr)\n\n# get the null percentages\nnull_percentages <- sapply(data, function(x) sum(str_detect(x, \"NULL\"))/length(x))\n\n# put it into a tibble and arrange it\n\nnull_percentages_tibble <- tibble(column = names(data), null_percentage = null_percentages)\nnull_percentages_tibble %>%\n  arrange(desc(null_percentage))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"column\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"null_percentage\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"company\",\"2\":\"0.943068934\"},{\"1\":\"agent\",\"2\":\"0.136862384\"},{\"1\":\"country\",\"2\":\"0.004087445\"},{\"1\":\"hotel\",\"2\":\"0.000000000\"},{\"1\":\"is_canceled\",\"2\":\"0.000000000\"},{\"1\":\"lead_time\",\"2\":\"0.000000000\"},{\"1\":\"arrival_date_year\",\"2\":\"0.000000000\"},{\"1\":\"arrival_date_month\",\"2\":\"0.000000000\"},{\"1\":\"arrival_date_week_number\",\"2\":\"0.000000000\"},{\"1\":\"arrival_date_day_of_month\",\"2\":\"0.000000000\"},{\"1\":\"stays_in_weekend_nights\",\"2\":\"0.000000000\"},{\"1\":\"stays_in_week_nights\",\"2\":\"0.000000000\"},{\"1\":\"adults\",\"2\":\"0.000000000\"},{\"1\":\"babies\",\"2\":\"0.000000000\"},{\"1\":\"meal\",\"2\":\"0.000000000\"},{\"1\":\"market_segment\",\"2\":\"0.000000000\"},{\"1\":\"distribution_channel\",\"2\":\"0.000000000\"},{\"1\":\"is_repeated_guest\",\"2\":\"0.000000000\"},{\"1\":\"previous_cancellations\",\"2\":\"0.000000000\"},{\"1\":\"previous_bookings_not_canceled\",\"2\":\"0.000000000\"},{\"1\":\"reserved_room_type\",\"2\":\"0.000000000\"},{\"1\":\"assigned_room_type\",\"2\":\"0.000000000\"},{\"1\":\"booking_changes\",\"2\":\"0.000000000\"},{\"1\":\"deposit_type\",\"2\":\"0.000000000\"},{\"1\":\"days_in_waiting_list\",\"2\":\"0.000000000\"},{\"1\":\"customer_type\",\"2\":\"0.000000000\"},{\"1\":\"adr\",\"2\":\"0.000000000\"},{\"1\":\"required_car_parking_spaces\",\"2\":\"0.000000000\"},{\"1\":\"total_of_special_requests\",\"2\":\"0.000000000\"},{\"1\":\"reservation_status\",\"2\":\"0.000000000\"},{\"1\":\"reservation_status_date\",\"2\":\"0.000000000\"},{\"1\":\"children\",\"2\":\"NA\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nWe can see that `company`, `agent` and `country` have \"NULL\" strings as values which are functionally equivalent to `na` / `nan` or garbage values. Additionally, `children` has some `na` values. We can replace these strings with meaningful values.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nreplace_garbage <- c(country = \"Unknown\", agent = 0, company = 0)\n\n# find indices that have `na`\nna_indices <- which(is.na(data$children))\ndata$children[na_indices] <- 0.0\n\n# Use a for loop to replace missing values in each column\nfor (col in names(replace_garbage)) {\n  data[data[,col] == \"NULL\", col] <- replace_garbage[col]\n}\n\nhead(data)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"hotel\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"is_canceled\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"lead_time\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"arrival_date_year\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"arrival_date_month\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"arrival_date_week_number\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"arrival_date_day_of_month\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"stays_in_weekend_nights\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"stays_in_week_nights\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"adults\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"children\"],\"name\":[11],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"babies\"],\"name\":[12],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"meal\"],\"name\":[13],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"country\"],\"name\":[14],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"market_segment\"],\"name\":[15],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"distribution_channel\"],\"name\":[16],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"is_repeated_guest\"],\"name\":[17],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"previous_cancellations\"],\"name\":[18],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"previous_bookings_not_canceled\"],\"name\":[19],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"reserved_room_type\"],\"name\":[20],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"assigned_room_type\"],\"name\":[21],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"booking_changes\"],\"name\":[22],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"deposit_type\"],\"name\":[23],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"agent\"],\"name\":[24],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"company\"],\"name\":[25],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"days_in_waiting_list\"],\"name\":[26],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"customer_type\"],\"name\":[27],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"adr\"],\"name\":[28],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"required_car_parking_spaces\"],\"name\":[29],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"total_of_special_requests\"],\"name\":[30],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"reservation_status\"],\"name\":[31],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"reservation_status_date\"],\"name\":[32],\"type\":[\"date\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Resort Hotel\",\"2\":\"0\",\"3\":\"342\",\"4\":\"2015\",\"5\":\"July\",\"6\":\"27\",\"7\":\"1\",\"8\":\"0\",\"9\":\"0\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"BB\",\"14\":\"PRT\",\"15\":\"Direct\",\"16\":\"Direct\",\"17\":\"0\",\"18\":\"0\",\"19\":\"0\",\"20\":\"C\",\"21\":\"C\",\"22\":\"3\",\"23\":\"No Deposit\",\"24\":\"0\",\"25\":\"0\",\"26\":\"0\",\"27\":\"Transient\",\"28\":\"0\",\"29\":\"0\",\"30\":\"0\",\"31\":\"Check-Out\",\"32\":\"2015-07-01\"},{\"1\":\"Resort Hotel\",\"2\":\"0\",\"3\":\"737\",\"4\":\"2015\",\"5\":\"July\",\"6\":\"27\",\"7\":\"1\",\"8\":\"0\",\"9\":\"0\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"BB\",\"14\":\"PRT\",\"15\":\"Direct\",\"16\":\"Direct\",\"17\":\"0\",\"18\":\"0\",\"19\":\"0\",\"20\":\"C\",\"21\":\"C\",\"22\":\"4\",\"23\":\"No Deposit\",\"24\":\"0\",\"25\":\"0\",\"26\":\"0\",\"27\":\"Transient\",\"28\":\"0\",\"29\":\"0\",\"30\":\"0\",\"31\":\"Check-Out\",\"32\":\"2015-07-01\"},{\"1\":\"Resort Hotel\",\"2\":\"0\",\"3\":\"7\",\"4\":\"2015\",\"5\":\"July\",\"6\":\"27\",\"7\":\"1\",\"8\":\"0\",\"9\":\"1\",\"10\":\"1\",\"11\":\"0\",\"12\":\"0\",\"13\":\"BB\",\"14\":\"GBR\",\"15\":\"Direct\",\"16\":\"Direct\",\"17\":\"0\",\"18\":\"0\",\"19\":\"0\",\"20\":\"A\",\"21\":\"C\",\"22\":\"0\",\"23\":\"No Deposit\",\"24\":\"0\",\"25\":\"0\",\"26\":\"0\",\"27\":\"Transient\",\"28\":\"75\",\"29\":\"0\",\"30\":\"0\",\"31\":\"Check-Out\",\"32\":\"2015-07-02\"},{\"1\":\"Resort Hotel\",\"2\":\"0\",\"3\":\"13\",\"4\":\"2015\",\"5\":\"July\",\"6\":\"27\",\"7\":\"1\",\"8\":\"0\",\"9\":\"1\",\"10\":\"1\",\"11\":\"0\",\"12\":\"0\",\"13\":\"BB\",\"14\":\"GBR\",\"15\":\"Corporate\",\"16\":\"Corporate\",\"17\":\"0\",\"18\":\"0\",\"19\":\"0\",\"20\":\"A\",\"21\":\"A\",\"22\":\"0\",\"23\":\"No Deposit\",\"24\":\"304\",\"25\":\"0\",\"26\":\"0\",\"27\":\"Transient\",\"28\":\"75\",\"29\":\"0\",\"30\":\"0\",\"31\":\"Check-Out\",\"32\":\"2015-07-02\"},{\"1\":\"Resort Hotel\",\"2\":\"0\",\"3\":\"14\",\"4\":\"2015\",\"5\":\"July\",\"6\":\"27\",\"7\":\"1\",\"8\":\"0\",\"9\":\"2\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"BB\",\"14\":\"GBR\",\"15\":\"Online TA\",\"16\":\"TA/TO\",\"17\":\"0\",\"18\":\"0\",\"19\":\"0\",\"20\":\"A\",\"21\":\"A\",\"22\":\"0\",\"23\":\"No Deposit\",\"24\":\"240\",\"25\":\"0\",\"26\":\"0\",\"27\":\"Transient\",\"28\":\"98\",\"29\":\"0\",\"30\":\"1\",\"31\":\"Check-Out\",\"32\":\"2015-07-03\"},{\"1\":\"Resort Hotel\",\"2\":\"0\",\"3\":\"14\",\"4\":\"2015\",\"5\":\"July\",\"6\":\"27\",\"7\":\"1\",\"8\":\"0\",\"9\":\"2\",\"10\":\"2\",\"11\":\"0\",\"12\":\"0\",\"13\":\"BB\",\"14\":\"GBR\",\"15\":\"Online TA\",\"16\":\"TA/TO\",\"17\":\"0\",\"18\":\"0\",\"19\":\"0\",\"20\":\"A\",\"21\":\"A\",\"22\":\"0\",\"23\":\"No Deposit\",\"24\":\"240\",\"25\":\"0\",\"26\":\"0\",\"27\":\"Transient\",\"28\":\"98\",\"29\":\"0\",\"30\":\"1\",\"31\":\"Check-Out\",\"32\":\"2015-07-03\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\ndim(data) # 119390x32\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 119390     32\n```\n:::\n:::\n\n\nWe can use hints from manual inspection and dig in a little more.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata %>% count(meal) %>% arrange(-n)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"meal\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"n\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"BB\",\"2\":\"92310\"},{\"1\":\"HB\",\"2\":\"14463\"},{\"1\":\"SC\",\"2\":\"10650\"},{\"1\":\"Undefined\",\"2\":\"1169\"},{\"1\":\"FB\",\"2\":\"798\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\naccording to the dataset description, Undefined/SC = no meal. So we can convert all the \"Undefined\" values to SC.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata$meal <- replace(data$meal, data$meal == \"Undefined\", \"SC\")\n```\n:::\n\n\nWe can also look the \\# of guests in each room and see if we get some insight. Let's plot them into three bins: <1, 1-2, and >=3. We'll use a polar coordinate pie chart for this as it's easy to show the relative differences in loose self-constructed bins that way.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\n\ndata %>%\n  group_by(guests = adults + children + babies) %>%\n  summarize(count = n()) %>%\n  mutate(guests = ifelse(guests == 0, \"0\", ifelse(guests <= 2, \"1 to 2\", \">=3\"))) %>%\n  ggplot(aes(x = guests, y = count, fill = guests)) +\n  geom_bar(stat = \"identity\") +\n  ggtitle(\"Total number of guests\") +\n  theme(plot.title = element_text(hjust = 0.5)) +\n  coord_polar(\"y\", start = 0) +\n  scale_fill_manual(values = c(\"#F8766D\", \"#00BFC4\", \"#619CFF\"))\n```\n\n::: {.cell-output-display}\n![](hw3_tanmay_agrawal_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\nWe observe that there are non-zero entries in the pie with \\# of `adults` + `children` + `babies` = 0. Let's get rid of those rows.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- data %>% filter(adults != 0 | children != 0 | babies != 0)\ndim(data) # 119210x32\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 119210     32\n```\n:::\n:::\n\n\n## EDA: Let's explore the data a little more\n\nSince we don't know where these hotels are located, we can try to get hints from the guests that visit these hotels. Let's plot them on a pie chart and check what countries are represented in this data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(dplyr)\n\n# get number of guests by country who haven't cancelled\ncountry_data <- data %>% \n  filter(is_canceled == 0) %>% \n  group_by(country) %>% \n  summarise(number_of_guests = n()) %>% \n  ungroup()\n\n# calculate the percentage of guests by country\ntotal_guests <- sum(country_data$number_of_guests)\ncountry_data$Guests_in_percent <- round(country_data$number_of_guests / total_guests * 100, 2)\n\n# group countries with less representation\ncountry_data$country <- ifelse(country_data$Guests_in_percent < 2, \"Other\", country_data$country)\n\n# polar pie plot\nggplot(country_data, aes(x = \"\", y = number_of_guests, fill = country)) +\n  geom_bar(width = 1, stat = \"identity\") +\n  ggtitle(\"Home country of guests\") +\n  coord_polar(theta = \"y\")\n```\n\n::: {.cell-output-display}\n![](hw3_tanmay_agrawal_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\nWe observe that Portugal and Great Britain are the countries that are over represented in this data. Which could mean that the hotels are close to those two countries and likely in Europe.\n\n## Potential research questions\n\nWe can see that the data also records some interesting columns like `lead_time`, `market_segment`, `distribution_channel`, `is_repeated_guest`, `previous_cancellations`, `booking_changes` which could be used as predictive signals to determine the potential value of a customer. For instance, if a customer is making too many changes, have a history of cancelling, and from a particular distribution channel that might lead us to think that they are likely to make a last minute cancellation. This could be used to make predictions about availability and dynamic pricing of rooms -- akin to what the airline industry does. A lot of questions still remain unanswered from this preliminary EDA.\n\nFor instance, \n- if we can figure out how much guests pay for a room per night we can figure out how the price per night changes over the year? This would help us to know what the best time of the year is to get the best price.\n\n- We similarly check which months are the busiest and compare those two charts. This would tell us how closely the price of a room is tied to the availability of a room.\n\n- Finally we could use these insights among others to inform our statistical models for predicting the cancellations before they happen. We can use a part of the dataset to make predictions and calculate how accurate our models are.\n",
    "supporting": [
      "hw3_tanmay_agrawal_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}